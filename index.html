<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>Register for Appointment</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="style.css" rel="stylesheet"> 
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Caveat&display=swap" rel="stylesheet">
</head>

<body class="container-fluid container-md">
    <div id="loadingOverlay" style="
        display: none;
        position: fixed;
        top: 0; left: 0;
        width: 100%; height: 100%;
        background: rgba(255,255,255,0.8);
        z-index: 9999;
        align-items: center;
        justify-content: center;
    ">
      <div class="text-center">
        <div class="spinner-border text-primary" role="status">
          <span class="visually-hidden">Loading...</span>
        </div>
        <div class="mt-2">Please wait…</div>
      </div>
    </div>

    <header class="container mb-5">
        <div class="row align-items-center">
            <div class="col-auto">
                <img src="https://prism.org/Lab_Assets/phl-logo-color.png" alt="Prism Health Lab Logo" class="img-fluid" style="max-height:60px;">
            </div>
            <div class="col text-center">
                <h1 class="mb-0">Patient Registration</h1>
            </div>
        </div>
    </header>

    <div>
        <h2 class="d-flex justify-content-between align-items-center">
            <span id="eventDetails"></span>
        </h2>
    </div>

    <div id="slotSection">
        <h3 class="d-flex justify-content-between align-items-center">
            <span>Select an Appointment Slot</span>
        </h3>
        <div id="slotsGrid">
            </div>
        <div id="waitlistSection" class="text-center my-4 d-none">
            <p>All appointment slots are currently full.</p>
            <button id="joinWaitlistBtn" class="btn btn-primary">Join the Waitlist</button>
        </div>
    </div>

    <div id="formSection" class="d-none">
        <h3 class="d-flex justify-content-between align-items-center">
            <button class="btn btn-outline-secondary" type="button" id="goBackButton">Back</button>
            <span id="timer"></span>
        </h3>
        <h3 class="text-center">
            <span>Complete Your Registration</span>
        </h3>
          <form id="regForm">
          <!-- Demographics -->
          <div class="mb-4">
            <h4>Demographics</h4>
            <div class="row g-3">
              <div class="col-md-4">
                <label for="firstName" class="form-label">First Name *</label>
                <input type="text" class="form-control" id="firstName" name="firstName" required>
              </div>
              <div class="col-md-4">
                <label for="middleName" class="form-label">Middle Name</label>
                <input type="text" class="form-control" id="middleName" name="middleName">
              </div>
              <div class="col-md-4">
                <label for="lastName" class="form-label">Last Name *</label>
                <input type="text" class="form-control" id="lastName" name="lastName" required>
              </div>
              <div class="col-md-4">
                <label for="dob" class="form-label">Date of Birth *</label>
                <input type="date" class="form-control" id="dob" name="dob" required>
              </div>
              <div class="col-md-4">
                <label for="gender" class="form-label">Gender *</label>
                <select class="form-select" id="gender" name="gender" required>
                  <option value="" disabled selected></option>
                  <option>Male</option>
                  <option>Female</option>
                  <option>Other</option>
                  <option>Decline to Answer</option>
                </select>
              </div>
              <div class="col-md-4">
                <label for="race" class="form-label">Race *</label>
                <select class="form-select" id="race" name="race" required>
                  <option value="" disabled selected></option>
                  <option>American Indian or Alaska Native</option>
                  <option>Asian</option>
                  <option>White or Caucasian</option>
                  <option>Black or African American</option>
                  <option>Middle Eastern or North African</option>
                  <option>Native Hawaiian or Pacific Islander</option>
                  <option>Prefer not to answer</option>
                  <option>Unknown</option>
                </select>
              </div>
              <div class="col-md-4">
                <label for="ethnicity" class="form-label">Ethnicity *</label>
                <select class="form-select" id="ethnicity" name="ethnicity" required>
                  <option value="" disabled selected></option>
                  <option>Hispanic or Latino</option>
                  <option>Not Hispanic or Latino</option>
                  <option>Prefer not to answer</option>
                </select>
              </div>
              <div id="parentFields" class="col-12 d-none">
                <label class="form-label">Parent/Guardian Information</label>
                <div class="row g-3">
                  <div class="col-md-4">
                    <input type="text" class="form-control" id="parentName" name="parentName" placeholder="Name">
                  </div>
                  <div class="col-md-4">
                    <input type="text" class="form-control" id="parentRel" name="parentRel" placeholder="Relationship">
                  </div>
                  <div class="col-md-4">
                    <input type="tel" class="form-control" id="parentContact" name="parentContact" pattern="^(?:\(\d{3}\)\s*|\d{3}[.\-]?)\d{3}[.\-]?\d{4}$" placeholder="(XXX) XXX-XXXX">
                  </div>
                </div>
              </div>
              <div class="col-md-6">
                <label for="street" class="form-label">Street Address</label>
                <input type="text" class="form-control" id="street" name="street">
              </div>
              <div class="col-md-4">
                <label for="city" class="form-label">City</label>
                <input type="text" class="form-control" id="city" name="city">
              </div>
              <div class="col-md-4">
                <label for="state" class="form-label">State</label>
                <input type="text" class="form-control" id="state" name="state">
              </div>
              <div class="col-md-4">
                <label for="zip" class="form-label">Zip Code *</label>
                <input type="text" class="form-control" id="zip" name="zip"
                       placeholder="12345" pattern="\d{5}" maxlength="5"
                       inputmode="numeric" required>
              </div>
              <div class="col-md-6">
                <label for="cell" class="form-label">Cell Phone *</label>
                <input type="tel" class="form-control" id="cell" name="cell"
                       placeholder="(XXX) XXX-XXXX"
                       pattern="^(?:\(\d{3}\)\s*|\d{3}[.\-]?)\d{3}[.\-]?\d{4}$" required>
              </div>
              <div class="col-md-6">
                <label for="home" class="form-label">Home Phone</label>
                <input type="tel" class="form-control" id="home" name="home"
                       placeholder="(XXX) XXX-XXXX"
                       pattern="^(?:\(\d{3}\)\s*|\d{3}[.\-]?)\d{3}[.\-]?\d{4}$">
              </div>
              <div class="col-md-6">
                <label for="email" class="form-label">Email Address *</label>
                <input type="email" class="form-control" id="email" name="email"
                       placeholder="user@example.com"
                       pattern="^[A-Za-z0-9._%+\-]+@[A-Za-z0-9.\-]+\.[A-Za-z]{2,}$"
                       required>
              </div>
              <div class="col-md-6">
                <label for="ssn" class="form-label">Social Security #</label>
                <input type="text" class="form-control" id="ssn" name="ssn">
              </div>
            </div>
          </div>
            <div class="form-check mb-4">
              <input class="form-check-input" type="checkbox" id="hasInsuranceCheck">
              <label class="form-check-label" for="hasInsuranceCheck">
                I have insurance information to provide
              </label>
            </div>
  
          <!-- Insurance -->
          <div class="mb-4 d-none" id="insuranceSection">
            <h4>Insurance</h4>
            <div class="row g-3">
              <div class="col-md-6">
                <label for="primaryIns" class="form-label">Primary Insurance</label>
                <input type="text" class="form-control" id="primaryIns" name="primaryIns">
              </div>
              <div class="col-md-6">
                <label for="primaryPayer" class="form-label">Primary Insurance Payer Name</label>
                <input type="text" class="form-control" id="primaryPayer" name="primaryPayer">
              </div>
              <div class="col-md-6">
                <label for="primaryPlan" class="form-label">Primary Insurance Plan Name</label>
                <input type="text" class="form-control" id="primaryPlan" name="primaryPlan">
              </div>
              <div class="col-md-3">
                <label for="primaryId" class="form-label">Primary Insurance ID</label>
                <input type="text" class="form-control" id="primaryId" name="primaryId">
              </div>
              <div class="col-md-3">
                <label for="primaryGroup" class="form-label">Group #</label>
                <input type="text" class="form-control" id="primaryGroup" name="primaryGroup">
              </div>
              <div class="col-md-6">
                <label for="primaryPayerId" class="form-label">Primary Insurance Payer ID</label>
                <input type="text" class="form-control" id="primaryPayerId" name="primaryPayerId">
              </div>
              <div class="col-md-6">
                <label for="secondaryIns" class="form-label">Secondary Insurance</label>
                <input type="text" class="form-control" id="secondaryIns" name="secondaryIns">
              </div>
              <div class="col-md-6">
                <label for="secondaryPlan" class="form-label">Secondary Insurance Plan Name</label>
                <input type="text" class="form-control" id="secondaryPlan" name="secondaryPlan">
              </div>
              <div class="col-md-3">
                <label for="secondaryId" class="form-label">Secondary Insurance ID</label>
                <input type="text" class="form-control" id="secondaryId" name="secondaryId">
              </div>
              <div class="col-md-3">
                <label for="secondaryGroup" class="form-label">Group #</label>
                <input type="text" class="form-control" id="secondaryGroup" name="secondaryGroup">
              </div>
              <div class="col-md-6">
                <label for="secondaryPayerId" class="form-label">Secondary Insurance Payer ID</label>
                <input type="text" class="form-control" id="secondaryPayerId" name="secondaryPayerId">
              </div>
            </div>
          </div>
  
          <!-- Consent & Signature -->
          <div class="mb-4">
            <h4>Consent &amp; Signature</h4>
            <div class="mb-3 form-check">
              <input type="checkbox" class="form-check-input" id="electronicConsent" name="electronicConsent">
              <label class="form-check-label" for="electronicConsent">I agree to use electronic records and electronic signatures.</label>
            </div>
            <div class="mb-3">
              <label class="form-label">
                May we contact you for record collection, scheduling, reminders, and results related to this program (informational only; automated systems may be used)? <span class="text-danger">*</span>
              </label>
              <div class="form-check">
                <input class="form-check-input" type="checkbox" value="" id="consentCalls" name="consentCalls">
                <label class="form-check-label" for="consentCalls">
                  I consent to phone calls
                </label>
              </div>
              <div class="form-check">
                <input class="form-check-input" type="checkbox" value="" id="consentTexts" name="consentTexts">
                <label class="form-check-label" for="consentTexts">
                  I consent to text messages (reply STOP to opt out; standard rates may apply)
                </label>
              </div>
              <div class="form-check">
                <input class="form-check-input" type="checkbox" value="true" id="consentEmails" name="consentEmails">
                <label class="form-check-label" for="consentEmails">
                  I consent to emails
                </label>
              </div>
            </div>
            <div class="accordion mb-3" id="consentAccordion">
              <div class="accordion-item">
                <h2 class="accordion-header" id="headingOne">
                  <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne" aria-expanded="false" aria-controls="collapseOne">
                    <strong>Vaccination Consent</strong>
                  </button>
                </h2>
                <div id="collapseOne" class="accordion-collapse collapse" aria-labelledby="headingOne" data-bs-parent="#consentAccordion">
                  <div class="accordion-body">
                    <p>
                      I consent to PRISM HEALTH reviewing school health records and providing screening, education, outreach, and clinically indicated services (e.g., physicals, immunizations, lab tests) with education and referrals as needed. I will receive/read CDC Vaccine Information Statements; I understand risks/benefits and may decline any specific vaccine at the time of service. Unless I limit in writing, this consent covers any age‑appropriate immunizations recommended by CDC/ACIP for school or routine care; I may decline any specific vaccine at the time of service. I authorize Prism (as an IDPH I‑CARE user) to query/retrieve/update my child’s immunization history in I‑CARE and to share immunization/relevant information with my child’s school/district (including CPS), ISBE, IDPH (including I‑CARE/HIE), CDPH, HFS/Medicaid and managed care plans, our health‑care professionals/clinics, school‑based health centers, FQHC partners, labs, pharmacies, and payers as needed to arrange/provide/pay for services; I also authorize my child’s school/district to disclose relevant health/shot records to Prism for record verification and coordination. Record review/consultation is free. If I later request billable services, I authorize Prism to submit claims and request that benefits be paid to Prism and I agree to be responsible for any copays/coinsurance/deductibles and for services not covered by program funding; I will be clearly notified in advance of any out‑of‑pocket costs before services are provided or billed. Any patient‑responsible amount is due at the time of service or, if invoiced after the visit, upon receipt. I acknowledge CPS health deadlines; I consent to phone/text/email communications (STOP to opt out; standard rates may apply). I release and hold harmless CPS, my child’s school/district, the City of Chicago/CDPH, ISBE, IDPH, HFS/Medicaid, and Prism/Foundation and partners, except for willful or wanton misconduct. Special situations: DCFS guardianship requires DCFS consent before services. Term: 365 days unless revoked in writing; revocation does not affect prior actions; information disclosed may be re‑disclosed. Privacy Practices available on request.
                    </p>
                  </div>
                </div>
              </div>
            </div>
            <div class="mb-3 form-check">
              <input type="checkbox" class="form-check-input" id="certifyConsent" name="certifyConsent" required>
              <label class="form-check-label" for="certifyConsent">I certify that I am the Parent/Legal Guardian, the individual receiving services and at least 18 years of age/emancipated, or a Legally Authorized Representative, and that I have read and agree to the Consent & Authorizations above.</label>
            </div>
            <p>Signature:</p>
            <ul class="nav nav-tabs" id="signatureTabs" role="tablist">
              <li class="nav-item" role="presentation">
                <button class="nav-link active" id="draw-tab" data-bs-toggle="tab" data-bs-target="#draw-pane" type="button" role="tab" aria-controls="draw-pane" aria-selected="true">Draw Signature</button>
              </li>
              <li class="nav-item" role="presentation">
                <button class="nav-link" id="type-tab" data-bs-toggle="tab" data-bs-target="#type-pane" type="button" role="tab" aria-controls="type-pane" aria-selected="false">Type Signature</button>
              </li>
            </ul>
            
            <div class="tab-content border border-top-0 p-3" id="signatureTabContent">
              <div class="tab-pane fade show active" id="draw-pane" role="tabpanel" aria-labelledby="draw-tab">
                <p>Use your mouse or finger to draw your signature:</p>
                <canvas id="sigPad" class="border"></canvas><br>
                <button class="btn btn-outline-secondary btn-sm mt-2" type="button" id="clearSignatureBtn">Clear</button>
              </div>
            
              <div class="tab-pane fade" id="type-pane" role="tabpanel" aria-labelledby="type-tab">
                <p>Type your name and it will be converted into a signature:</p>
                <input type="text" class="form-control" id="typedName" style="font-family: 'Caveat', cursive; font-size: 2.5rem; border: none; border-bottom: 1px solid #ccc;">
                <canvas id="typeCanvas" style="display: none;"></canvas>
              </div>
            </div>
          </div>
  
          <button class="btn btn-primary" type="submit">Submit Registration</button>
        </form>
    </div>

    <div id="confirmationSection" class="container d-none mt-5">
        <h2>Registration Confirmed</h2>
        <p><strong>Event:</strong> <span id="confEventName"></span></p>
        <p><strong>Date:</strong> <span id="confEventDate"></span></p>
        <p><strong>Patient:</strong> <span id="confPatientName"></span></p>
        <p><strong>Date of Birth:</strong> <span id="confPatientDob"></span></p>
        <p><strong>Appointment ID:</strong> <span id="confApptId"></span></p>
        <div class="mt-3">
            <img id="confQrCode" alt="QR code for Appointment ID" />
        </div>
        <p><i>A confirmation has been emailed to you. Please feel free to take a screenshot.</i></p>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/signature_pad@4.1.7/dist/signature_pad.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>

    <script src="script.js"></script>
</body>
</html>
